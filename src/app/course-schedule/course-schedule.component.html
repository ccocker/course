<body>
  <div class="filter-panels">
    <div class="panel courses-panel">
      <mat-toolbar color="primary">
        <span>Select Courses</span>
        <span class="toolbar-spacer"></span>
        <button
          mat-icon-button
          (click)="selectAllCourses()"
          matTooltip="Select all courses"
        >
          <mat-icon>select_all</mat-icon>
        </button>
        <button
          mat-icon-button
          (click)="deselectAllCourses()"
          matTooltip="Deselect all courses"
        >
          <mat-icon>clear</mat-icon>
        </button>
      </mat-toolbar>
      <mat-form-field appearance="fill">
        <mat-select [(value)]="selectedCourses" multiple>
          <mat-option
            *ngFor="let course of coursesList"
            [value]="course.code"
            >{{ course.name }}</mat-option
          >
        </mat-select>
      </mat-form-field>
    </div>

    <div class="panel staff-panel">
      <mat-toolbar color="accent">
        <span>Select Staff</span>
        <span class="toolbar-spacer"></span>
        <button
          mat-icon-button
          (click)="selectAllStaff()"
          [disabled]="selectedStaff.length === staffList.length"
          matTooltip="Select all staff"
        >
          <mat-icon>select_all</mat-icon>
        </button>
        <button
          mat-icon-button
          (click)="deselectAllStaff()"
          [disabled]="selectedStaff.length === 0"
          matTooltip="Deselect all staff"
        >
          <mat-icon>clear</mat-icon>
        </button>
      </mat-toolbar>
      <mat-form-field appearance="fill">
        <mat-select [(value)]="selectedStaff" multiple>
          <mat-option *ngFor="let staff of staffList" [value]="staff.enumber"
            >{{ staff.firstName }} {{ staff.lastName }}</mat-option
          >
        </mat-select>
      </mat-form-field>
    </div>

    <div class="panel understaffed-toggle-panel">
      <mat-toolbar color="warn">
        <span>{{
          showOnlyUnderstaffed
            ? "Showing Classes Needing Staff"
            : "Showing All Classes"
        }}</span>
        <span class="toolbar-spacer"></span>
        <button
          mat-icon-button
          (click)="toggleUnderstaffedFilter()"
          matTooltip="Toggle understaffed filter"
        >
          <mat-icon>{{
            showOnlyUnderstaffed ? "visibility_off" : "visibility"
          }}</mat-icon>
        </button>
      </mat-toolbar>
    </div>
  </div>

  <div class="timetable">
    <div class="header" style="grid-column-start: 1; grid-row: 1">Time</div>
    <!-- Dynamic headers for each day -->
    <div
      *ngFor="let day of weekdays"
      class="header"
      [style.gridColumn]="
        headerColumns[day].start + ' / span ' + headerColumns[day].span
      "
      style="grid-row: 1"
    >
      {{ day }}
    </div>

    <!-- Timeslots -->
    <div
      *ngFor="let timeSlot of timeSlots; let i = index"
      class="timeslot"
      [style.gridColumnStart]="1"
      [style.gridRow]="i + 2"
    >
      {{ timeSlot.startTime }} - {{ timeSlot.endTime }}
    </div>

    <!-- Events -->

    <div
      *ngFor="let event of schedule"
      class="event"
      [ngStyle]="{
        'grid-column-start': event.gridColumnStart,
        'grid-column-end': event.gridColumnEnd,
        'grid-row-start': event.gridRowStart,
        'grid-row-end': event.gridRowEnd,
        border: isUnderstaffed(event) ? '3px solid red' : '1px solid #dddddd',
        'background-color': isUnderstaffed(event)
          ? '#CCCCCC'
          : getEventColor(event),
        display: shouldDisplayEvent(event) ? 'block' : 'none'
      }"
    >
      <div>
        <br />
        {{ event.course.code }} - G{{ event.class.offeringGroup.group }} -
        {{ event.class.classNumber }}<br />
        {{ formatNumber(event.class.room.buildingNo, 3, "0") }}.{{
          event.class.room.floor
        }}.{{ formatNumber(event.class.room.roomNumber, 3, "0") }} ({{
          event.class.room.capacity
        }})<br />
        {{ event.class.timeslot.startTime }} - {{ event.class.timeslot.endTime
        }}<br /><br />
        <b
          >{{ event.class.offeringGroup.lead.firstName }}
          {{ event.class.offeringGroup.lead.lastName }}</b
        ><br />
        <div *ngFor="let tutor of event.class.staff">
          {{ tutor.firstName }} {{ tutor.lastName }}<br />
        </div>
        <br />
        <!-- New Checkbox for Class Availability Selection -->
        <input
          type="checkbox"
          [id]="'avail-' + event.course.code"
          (change)="selectClassAvailability(event.course.code)"
        />
        <!--
        <label [for]="'avail-' + event.course.code">Available</label>
        -->
      </div>
      <!-- Event details -->
    </div>
  </div>
</body>
